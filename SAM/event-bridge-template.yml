AWSTemplateFormatVersion: "2010-09-09"
Transform: AWS::Serverless-2016-10-31

Parameters:
  Environment:
    Type: String
    AllowedValues:
      - development
      - production

Resources:     
  LandingSqsRule:
      Type: AWS::Events::Rule
      Properties:
        EventPattern:
          source: ["aws.s3"]
          detail-type: ["AWS API CALL via CloudTrail"]
          detail:
            eventSource: ["s3.amazonaws.com"]
            eventName:
              - "PutObject"
              - "CopyObject"
              - "CompleteMultipartUpload"
              - "PostObject"
            requestParameters:
              bucketName:
                - Fn::ImportValue:
                    Fn::Sub:
                      "${Environment}-landing-bucket"
        State: "ENABLED"
        Targets:
          - Arn:
              Fn::ImportValue:
                Fn::Sub: "${Environment}-landing-queue-arn"
            Id: "LandingQueueTarget"

Outputs:
  LandingSqsRuleArn:
    Value: !GetAtt LandingSqsRule.Arn
    Export:
      Name "${Environment}-landing-sqs-rule"